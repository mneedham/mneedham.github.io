+++
draft = false
date="2014-03-24 23:44:29"
title="Remote profiling Neo4j using yourkit"
tag=['neo4j', 'yourkit']
category=['neo4j']
+++

<p><a href="http://www.yourkit.com/">yourkit</a> is my favourite JVM profiling tool and whilst it's really easy to profile a local JVM process, sometimes I need to profile a process on a remote machine.</p>


<p>In that case we need to first have the remote JVM started up with a <a href="http://www.yourkit.com/docs/80/help/agent.jsp">yourkit agent</a> parameter passed as one of the args to the Java program.</p>


<p>Since I'm mostly working with Neo4j this means we need to add the following to <cite>conf/neo4j-wrapper.conf</cite>:</p>



~~~text

wrapper.java.additional=-agentpath:/Users/markhneedham/Downloads/YourKit_Java_Profiler_2013_build_13074.app/bin/mac/libyjpagent.jnilib=port=8888
~~~

<p>If we run lsof with the Neo4j process ID we'll see that there's now a socket listening on port 8888:</p>



~~~text

java    4388 markhneedham   20u    IPv6 0x901df453b4e9a125       0t0      TCP *:8888 (LISTEN)
...
~~~

<p>We can connect to that via the 'Monitor Remote Applications' section of yourkit:</p>


<div>
<img src="http://www.markhneedham.com/blog/wp-content/uploads/2014/03/2014-03-24_23-39-59.png" alt="2014 03 24 23 39 59" title="2014-03-24_23-39-59.png" border="0" width="600" height="153" />
</div>

<p>In this case I'm demonstrating how to connect to it on my laptop and am using localhost but usually we'd specify the remote machine's host name instead.</p>


<p>We also need to ensure that port 8888 is open on any firewalls we have in front of the machine.</p>


<p>The file we refer to in the 'agentpath' flag is a bit different depending on the operating system we're using. All the <a href="http://www.yourkit.com/docs/80/help/agent.jsp">details are on the yourkit website</a>.</p>

